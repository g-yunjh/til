##### 가상 머신에 필요한 설정 자동으로 구성하기
- 원하는 구성을 자동으로 생성할 수 있도록 Vagrantfile을 작성할 수 있음
- 베이그런트 코드는 Ruby언어로 작성됨
- **수정된 Vagrantfile**
```Ruby
# -*- mode: ruby -*-
# vi: set ft=ruby :
Vagrant.configure("2") do |config| 
  config.vm.define "m-k8s" do |cfg|
    cfg.vm.box = "sysnet4admin/CentOS-k8s"
    cfg.vm.provider "virtualbox" do |vb|
      vb.name = "m-k8s(github_SysNet4Admin)"
      vb.cpus = 2
      vb.memory = 2048
      vb.customize ["modifyvm", :id, "--groups", "/k8s-SM(github_SysNet4Admin)"]
    end
    cfg.vm.host_name = "m-k8s"
    cfg.vm.network "private_network", ip: "192.168.1.10"
    cfg.vm.network "forwarded_port", guest: 22, host: 60010, auto_correct: true, id: "ssh"
    cfg.vm.synced_folder "../data", "/vagrant", disabled: true
  end
end
```
- 코드 실행
	- `vagrant up`: Vagrantfile에 설정된대로 Virtual Machine을 생성
	- `vagrant ssh`: ssh로 생성된 VM에 접속
	- `ip addr show eth1`: IP(192.168.1.10)이 제대로 설정되었는지 확인
	- `exit`: 접속 종료
##### 가상 머신에 추가 패키지 설치하기
- `    cfg.vm.provision "shell", path: "install_pkg.sh"`: 셸 프로비전 추가, install_pkg.sh라는 이름의 셸을 호출해 실행
```sh
#!/usr/bin/env bash
# install packages 
yum install epel-release -y
yum install vim-enhanced -y
```
- `vagrant provision`: 추가한 프로비전 구문을 실행
##### 가상 머신 추가로 구성하기
- 여러 개의 운영 체제를 자동으로 설치하고 구성
- `cfg.vm.provision "file", source: "ping_2_nds.sh", destination: "ping_2_nds.sh"`: 파일을 게스트 운영 체제에 전달하기 위해 "shell"이 아닌 "file"구문으로 변경
- `cfg.vm.provision "shell", path: "config.sh"`: config.sh를 게스트에서 실행
```ruby
(1..3).each do |i|
config.vm.define "w#{i}-k8s" do |cfg|
  cfg.vm.box = "sysnet4admin/CentOS-k8s"
  cfg.vm.provider "virtualbox" do |vb|
	vb.name = "w#{i}-k8s(github_SysNet4Admin)"
	vb.cpus = 1
	vb.memory = 1024
	vb.customize ["modifyvm", :id, "--groups", "/k8s-SM(github_SysNet4Admin)"]
  end
  cfg.vm.host_name = "w#{i}-k8s"
  cfg.vm.network "private_network", ip: "192.168.1.10#{i}"
  cfg.vm.network "forwarded_port", guest: 22, host: "6010#{i}",auto_correct: true, id: "ssh"
```
- 반복문을 통해서 3대의 CentOS를 추가함
- 보통 3대를 효율적으로 구성하기 위해 반복문이 사용됨
- 코드 실행:
	- `vagrant up`: 4대의 CentOS를 설치하고 구성
	- `vagrant ssh 가상머신이름`: 4대의 가상 머신 중 하나를 지정해서 접속